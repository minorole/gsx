#!/usr/bin/env zsh

# gsx -> gpane compatibility wrapper
# The 'gsx' command was renamed to 'gpane' to avoid conflict with Ghostscript.
# This wrapper shows a notice and forwards all commands to gpane.

set -eu

# Find gpane (same directory or in PATH)
GPANE_BIN="${0:A:h}/gpane"
if [[ ! -x "$GPANE_BIN" ]]; then
  GPANE_BIN="gpane"
fi

# Show notice once per day
NOTICE_FILE="${HOME}/.cache/gpane/rename-notice"
mkdir -p "$(dirname "$NOTICE_FILE")"

today=$(date +%Y-%m-%d)
if [[ ! -f "$NOTICE_FILE" ]] || [[ "$(cat "$NOTICE_FILE" 2>/dev/null)" != "$today" ]]; then
  echo ""
  echo "Note: 'gsx' has been renamed to 'gpane'"
  echo "      (to avoid conflict with Ghostscript)"
  echo ""
  echo "      Please use 'gpane' from now on."
  echo "      Upgrade: curl -sSL https://raw.githubusercontent.com/minorole/gsx/main/install.sh | bash"
  echo ""
  echo "$today" > "$NOTICE_FILE"
fi

exec "$GPANE_BIN" "$@"
